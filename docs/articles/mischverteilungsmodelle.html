<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bayesianische Mischverteilungsmodelle • bayeskurs</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">bayeskurs</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Bayesianische Mischverteilungsmodelle</h1>
                        <h4 class="author">Volker Schmid</h4>
            
            <h4 class="date"><ol start="17" style="list-style-type: decimal">
<li>Juli 2017</li>
</ol></h4>
          </div>

    
    
<div class="contents">
<div id="bayesianische-mischverteilungsmodelle" class="section level1">
<h1 class="hasAnchor">
<a href="#bayesianische-mischverteilungsmodelle" class="anchor"></a>Bayesianische Mischverteilungsmodelle</h1>
<div id="mischverteilungen" class="section level2">
<h2 class="hasAnchor">
<a href="#mischverteilungen" class="anchor"></a>Mischverteilungen</h2>
<ul>
<li>(Normal-)Verteilungsannahme basiert in der Regel auf der Annahme, dass die Beobachtungen identisch verteilt sind, es also eine Verteilung der Grundgesamtheit gibt</li>
<li>Alternative Annahme: Es gibt mehrere Gruppen in der Grundgesamheit, die alle die selbe Verteilungsklasse haben, aber unterschiedliche Parameter</li>
<li>Einfachster Fall: Mischung von Normalverteilungen</li>
</ul>
</div>
<div id="mischung-von-normalverteilungen" class="section level2 allowframebreaks">
<h2 class="hasAnchor">
<a href="#mischung-von-normalverteilungen" class="anchor"></a>Mischung von Normalverteilungen</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">seq</span>(-<span class="dv">10</span>, <span class="dv">10</span>, <span class="dt">length=</span><span class="dv">100</span>)
p &lt;-<span class="st"> </span><span class="fl">0.5</span>*<span class="kw">dnorm</span>(x,-<span class="dv">3</span>,<span class="dv">1</span>) +<span class="st"> </span><span class="fl">0.5</span>*<span class="kw">dnorm</span>(x,<span class="dv">3</span>,<span class="dv">1</span>)
<span class="kw">plot</span>(x,p, <span class="dt">type=</span><span class="st">"l"</span>)</code></pre></div>
<p><img src="mischverteilungsmodelle_files/figure-html/mvplot1-1.png" width="672"></p>
<ul>
<li>Natürlich sind auch verschiedene Varianzen und verschiedene Gewichte möglich</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">seq</span>(-<span class="dv">10</span>, <span class="dv">10</span>, <span class="dt">length=</span><span class="dv">100</span>)
p &lt;-<span class="st"> </span><span class="fl">0.3</span>*<span class="kw">dnorm</span>(x,-<span class="dv">5</span>,<span class="fl">0.5</span>) +<span class="st"> </span><span class="fl">0.5</span>*<span class="kw">dnorm</span>(x,<span class="dv">1</span>,<span class="dv">1</span>) +<span class="st"> </span><span class="fl">0.2</span>*<span class="kw">dnorm</span>(x,<span class="dv">6</span>,<span class="dv">2</span>)
<span class="kw">plot</span>(x,p, <span class="dt">type=</span><span class="st">"l"</span>)</code></pre></div>
<p><img src="mischverteilungsmodelle_files/figure-html/mvplot2-1.png" width="672"></p>
</div>
<div id="fragen" class="section level2">
<h2 class="hasAnchor">
<a href="#fragen" class="anchor"></a>Fragen</h2>
<ul>
<li>Welche Parameter und welche Gewichte haben die einzelnen Verteilungen?</li>
<li>Wieviele Mischverteilungen brauchen wir?</li>
<li>Zu welcher Verteilung gehört welche Beobachtung</li>
</ul>
</div>
<div id="latente-klassen" class="section level2">
<h2 class="hasAnchor">
<a href="#latente-klassen" class="anchor"></a>Latente Klassen</h2>
<p>Idee der Modellierung: Führe latente Klassen <span class="math inline">\(S_i\)</span> ein</p>
<p><span class="math display">\[ \begin{aligned}
x_i | S_i &amp; \sim N(\mu_{S_i},\sigma^2_{S_i})\\
\mu_{j} &amp;\sim N(\mu_0, \sigma^2_0)\\
\sigma^2_j &amp;\sim IG(a,b)\\
p(S_i=j) &amp;= \pi_j\\
(\pi_1,\ldots,\pi_K) &amp;\sim Diri(\alpha,\ldots,\alpha)
\end{aligned} \]</span></p>
<p>Dirichlet-Verteilung: <span class="math display">\[ p(\pi_1,\ldots,\pi_K) \propto \prod \pi_i^{\alpha_i-1} \]</span></p>
</div>
<div id="full-conditionals" class="section level2">
<h2 class="hasAnchor">
<a href="#full-conditionals" class="anchor"></a>Full conditionals</h2>
<ul>
<li>Die full conditional von <span class="math inline">\(\mu_j\)</span> sind Normalverteilungen, wobei die <span class="math inline">\(x_i\)</span> mit <span class="math inline">\(S_i=j\)</span> eingehen</li>
<li>Analog ist die full conditional von <span class="math inline">\(\sigma^2_j\)</span> eine IG-Verteilung</li>
<li>
<span class="math inline">\(p(S_i=j)\)</span> berechnet sich aus Dichte von <span class="math inline">\(x_i\)</span> mit <span class="math inline">\(\mu_j\)</span> und <span class="math inline">\(\sigma^2_j\)</span> (und Priori)</li>
<li>Full Conditional von <span class="math inline">\(\mathbf{\pi}\)</span> ist Dirichlet mit <span class="math inline">\((\alpha+n_1,\ldots,\alpha+n_k)\)</span>, wobei <span class="math inline">\(n_j\)</span> die aktuelle Anzahl der Beobachtungen in Klasse <span class="math inline">\(j\)</span> ist</li>
</ul>
</div>
<div id="beispiel" class="section level2 allowframebreaks">
<h2 class="hasAnchor">
<a href="#beispiel" class="anchor"></a>Beispiel</h2>
<p>Länge von 256 Fischen (aus D. M. Titterington, A. F. M. Smith and U.E. Makov (1985) Statistical Analysis of Finite Mixture Distributions. Wiley.)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(fish, <span class="dt">package=</span><span class="st">"bayesmix"</span>)
<span class="kw">hist</span>(fish$fish, <span class="dt">freq=</span><span class="ot">FALSE</span>, <span class="dt">n=</span><span class="dv">22</span>)
<span class="kw">lines</span>(<span class="kw">density</span>(fish$fish))</code></pre></div>
<p><img src="mischverteilungsmodelle_files/figure-html/Fischdaten-1.png" width="672"></p>
</div>
<div id="bayesmix-paket" class="section level2 allowframebreaks">
<h2 class="hasAnchor">
<a href="#bayesmix-paket" class="anchor"></a>bayesmix-Paket</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(bayesmix)
model &lt;-<span class="st"> </span><span class="kw">BMMmodel</span>(fish, <span class="dt">k =</span> <span class="dv">4</span>,
  <span class="dt">initialValues =</span> <span class="kw">list</span>(<span class="dt">S0 =</span> <span class="dv">2</span>),
  <span class="dt">priors =</span> <span class="kw">list</span>(<span class="dt">kind =</span> <span class="st">"independence"</span>,
  <span class="dt">parameter =</span> <span class="st">"priorsFish"</span>, 
  <span class="dt">hierarchical =</span> <span class="st">"tau"</span>))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(model)</code></pre></div>
<pre><code>## Data for nodes: b0, B0inv, nu0Half, g0Half, g0G0Half, k, N, e, y
## Initial values for nodes: eta, mu, tau, S0
## 
## Model specification in BUGS language:
## 
## var 
##  b0,
##      B0inv,
##      nu0Half,
##      g0Half,
##      g0G0Half,
##      k,
##      N,
##      eta[4], 
##  mu[4], 
##  tau[4], 
##  nu0S0Half,
##      S0,
##      e[4], 
##  y[256], 
##  S[256]; 
## 
## model    {
##  for (i in 1:N) {
##      y[i] ~ dnorm(mu[S[i]],tau[S[i]]);
##      S[i] ~ dcat(eta[]);
##  }
##  for (j in 1:k) {
##      mu[j] ~ dnorm(b0,B0inv);
##      tau[j] ~ dgamma(nu0Half,nu0S0Half);
##  }
##  S0 ~ dgamma(g0Half,g0G0Half);
##  nu0S0Half &lt;- nu0Half * S0;
## 
##  eta[] ~ ddirch(e[]);
## }</code></pre>
</div>
<div id="jags" class="section level2">
<h2 class="hasAnchor">
<a href="#jags" class="anchor"></a>JAGS</h2>
<ul>
<li>
<strong>JAGS</strong> oder <strong>Just another Gibbs sampler</strong> ist eine Software zur MCMC-Simulation.</li>
<li>Definition der Modelle entspricht der bei WinBUGS bzw. OpenBUGS</li>
<li>Anbindung an R und andere Sprachen</li>
</ul>
</div>
<div id="fortsetzung-beispiel" class="section level2 allowframebreaks">
<h2 class="hasAnchor">
<a href="#fortsetzung-beispiel" class="anchor"></a>Fortsetzung Beispiel</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">control &lt;-<span class="st"> </span><span class="kw">JAGScontrol</span>(<span class="dt">variables =</span> <span class="kw">c</span>(<span class="st">"mu"</span>, <span class="st">"tau"</span>, <span class="st">"eta"</span>,
    <span class="st">"S"</span>), <span class="dt">burn.in =</span> <span class="dv">1000</span>, <span class="dt">n.iter =</span> <span class="dv">5000</span>, <span class="dt">seed =</span> <span class="dv">10</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">z &lt;-<span class="st"> </span><span class="kw">JAGSrun</span>(fish, <span class="dt">model =</span> model, <span class="dt">control =</span> control)</code></pre></div>
<pre><code>## Compiling model graph
##    Declaring variables
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 256
##    Unobserved stochastic nodes: 266
##    Total graph size: 1047
## 
## Initializing model</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">zSort &lt;-<span class="st"> </span><span class="kw">Sort</span>(z, <span class="dt">by =</span> <span class="st">"mu"</span>)
zSort</code></pre></div>
<pre><code>## 
## Call:
## JAGSrun(y = fish, model = model, control = control)
## 
## Markov Chain Monte Carlo (MCMC) output:
## Start = 1001 
## End = 6000 
## Thinning interval = 1 
## 
##  Empirical mean, standard deviation and 95% CI for eta 
##          Mean      SD    2.5%  97.5%
## eta[1] 0.1189 0.02483 0.07530 0.1731
## eta[2] 0.5065 0.04458 0.41275 0.5863
## eta[3] 0.2746 0.04544 0.19466 0.3742
## eta[4] 0.1000 0.02937 0.05098 0.1658
## 
##  Empirical mean, standard deviation and 95% CI for mu 
##        Mean      SD  2.5%  97.5%
## mu[1] 3.382 0.15393 3.122  3.729
## mu[2] 5.278 0.07337 5.130  5.416
## mu[3] 7.437 0.14866 7.106  7.699
## mu[4] 9.979 0.39132 9.181 10.696
## 
##  Empirical mean, standard deviation and 95% CI for sigma2 
##             Mean      SD   2.5%  97.5%
## sigma2[1] 0.2996 0.11811 0.1456 0.5876
## sigma2[2] 0.3504 0.08497 0.2357 0.5174
## sigma2[3] 0.4815 0.19657 0.2404 0.9607
## sigma2[4] 1.0023 0.34858 0.5354 1.8441</code></pre>
</div>
<div id="medianmodell" class="section level2 allowframebreaks">
<h2 class="hasAnchor">
<a href="#medianmodell" class="anchor"></a>Medianmodell</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">postmed&lt;-<span class="kw">apply</span>(zSort$results, <span class="dv">2</span>, median)
x&lt;-<span class="kw">seq</span>(<span class="kw">min</span>(fish$fish), <span class="kw">max</span>(fish$fish), <span class="dt">length=</span><span class="dv">1000</span>)
d1 &lt;-<span class="st"> </span>postmed[<span class="dv">257</span>]*<span class="kw">dnorm</span>(x, postmed[<span class="dv">261</span>], <span class="kw">sqrt</span>(postmed[<span class="dv">265</span>]))
d2 &lt;-<span class="st"> </span>postmed[<span class="dv">258</span>]*<span class="kw">dnorm</span>(x, postmed[<span class="dv">262</span>], <span class="kw">sqrt</span>(postmed[<span class="dv">266</span>]))
d3 &lt;-<span class="st"> </span>postmed[<span class="dv">259</span>]*<span class="kw">dnorm</span>(x, postmed[<span class="dv">263</span>], <span class="kw">sqrt</span>(postmed[<span class="dv">267</span>]))
d4 &lt;-<span class="st"> </span>postmed[<span class="dv">260</span>]*<span class="kw">dnorm</span>(x, postmed[<span class="dv">264</span>], <span class="kw">sqrt</span>(postmed[<span class="dv">268</span>]))
d &lt;-<span class="st"> </span>d1 +<span class="st"> </span>d2 +<span class="st"> </span>d3 +<span class="st"> </span>d4
<span class="kw">hist</span>(fish$fish, <span class="dt">freq=</span><span class="ot">FALSE</span>, <span class="dt">n=</span><span class="dv">22</span>, <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="kw">max</span>(d)))
<span class="kw">lines</span>(x, d)
<span class="kw">lines</span>(x, d1, <span class="dt">col=</span><span class="st">"grey"</span>)
<span class="kw">lines</span>(x, d2, <span class="dt">col=</span><span class="st">"grey"</span>)
<span class="kw">lines</span>(x, d3, <span class="dt">col=</span><span class="st">"grey"</span>)
<span class="kw">lines</span>(x, d4, <span class="dt">col=</span><span class="st">"grey"</span>)</code></pre></div>
<p><img src="mischverteilungsmodelle_files/figure-html/medianmodel-1.png" width="672"></p>
</div>
<div id="posteriori-verteilung-der-klassen" class="section level2 allowframebreaks">
<h2 class="hasAnchor">
<a href="#posteriori-verteilung-der-klassen" class="anchor"></a>Posteriori-Verteilung der Klassen</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">S &lt;-<span class="st"> </span><span class="kw">apply</span>(zSort$results[,<span class="dv">1</span>:<span class="dv">256</span>],<span class="dv">2</span>,
     bioimagetools::table.n,<span class="dv">4</span>, <span class="dt">percentage=</span><span class="ot">TRUE</span>)
<span class="kw">barplot</span>(S, <span class="dt">col=</span><span class="kw">c</span>(<span class="st">"red"</span>,<span class="st">"green"</span>,<span class="st">"blue"</span>,<span class="st">"orange"</span>))</code></pre></div>
<p><img src="mischverteilungsmodelle_files/figure-html/S-1.png" width="672"></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      true
    </div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Volker Schmid.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
